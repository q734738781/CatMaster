# Jobflow-remote project configuration for CatMaster

name: catmaster
jobstore:
  docs_store:
    type: MongoStore
    host: "mongodb+srv://q734738781_db_user:JawSIZBqC02TUmQp@cluster0.ttgtyky.mongodb.net/"
    database: CatMaster
    collection_name: jobstore
  additional_stores: 
    data: 
      type: GridFSStore 
      database: CatMaster 
      collection_name: outputs_blobs
      host: "mongodb+srv://q734738781_db_user:JawSIZBqC02TUmQp@cluster0.ttgtyky.mongodb.net/"
queue:
  store:
    type: MongoStore
    host: "mongodb+srv://q734738781_db_user:JawSIZBqC02TUmQp@cluster0.ttgtyky.mongodb.net/"
    database: CatMaster
    collection_name: queuestore
  flows_collection: flows
  auxiliary_collection: jf_auxiliary
workers:
  cpu-worker:
    type: remote  # SSH to remote CPU cluster
    host: "166.111.35.183"
    port: 31125
    user: "chenhh"
    key_filename: "/home/chenhh/.ssh/id_ed25519"
    scheduler_type: slurm
    work_dir: "/public/home/chenhh/catmaster_work"
    resources:
      partition: batch
      ntasks: 32
      nodes: 1
      time: "7-00:00:00"
    # Environment setup on remote
    pre_run: |
      source /public/home/chenhh/intel/oneapi/setvars.sh --config="$HOME/oneapi-nopy.cfg" >/dev/null 2>&1 || true
      export VASP_STD_BIN=/public/home/chenhh/vasp_program/vasp6.4.3-vtst/bin/vasp_std
      export PATH=/public/home/chenhh/anaconda3/condabin:$PATH
      eval "$(conda shell.bash hook)"
      conda activate catmaster-cpu
      ulimit -s unlimited
      export PYTHONPATH=/public/home/chenhh/catmaster_code:$PYTHONPATH

    max_jobs: 100
  gpu-worker:
    type: remote  # SSH to remote GPU server
    host: "166.111.35.177"
    port: 22
    user: "chenhh"
    key_filename: "/home/chenhh/.ssh/id_ed25519"
    scheduler_type: shell  # Direct execution, use shell script
    work_dir: "/ssd/chenhh/catmaster_work"
    # Environment setup on remote
    pre_run: |
      ulimit -s unlimited
      export PATH=/ssd/chenhh/miniconda3/condabin:$PATH
      eval "$(conda shell.bash hook)"
      conda activate catmaster-gpu
      export PYTHONPATH=/ssd/chenhh/catmaster_code:$PYTHONPATH
    max_jobs: 10
